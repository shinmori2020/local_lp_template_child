# Complete Independent Modules System - AI Agent Guide

AIエージェント向け技術ガイド - WordPress Complete Modules System

## 🤖 AIエージェントへの重要な指示

### システム概要
このシステムは**完全独立型モジュール設計**で、各モジュールがCSS、JavaScript、ACF、ショートコードを内包しています。

### 最新の重要な仕様変更（v1.1）

⚠️ **重要**: 2024年の仕様変更により、ACF表示制御システムが大幅に改善されました。

---

## 🎛️ 動的ACF表示制御システム（最新仕様）

### 問題の背景
**従来の問題**: 全ページで全モジュールのACFフィールドが表示され、ユーザーが混乱していた

**解決策**: 手動選択式による確実なACF表示制御システムを実装

### 新システムの仕組み

#### 1. 手動選択方式
```
WordPress管理画面（ページ編集）
    ↓
右側サイドバー「🔧 使用するモジュールを選択」
    ↓  
チェックボックスで必要なモジュールを選択
    ↓
選択したモジュールのACFフィールドのみ表示
```

#### 2. 技術実装
- **メタボックスAPI**: WordPressの標準機能を使用
- **JavaScript制御**: リアルタイムでACF表示/非表示を切替
- **状態保存**: `_selected_modules` メタデータで選択状態を保存

### AIエージェントが知るべき重要なポイント

#### ✅ 推奨する回答パターン
**ユーザーが「ACFフィールドが表示されない」と言った場合**:
1. 「右側の🔧使用するモジュールを選択でチェックを確認してください」
2. 「使用したいモジュールにチェックが入っているか確認」
3. 「チェック後、該当するACFフィールドが下部に表示されます」

#### ❌ 避けるべき説明
- 複雑なlocation rule設定の説明
- 自動検出システムの説明（現在は無効）
- 古いカスタムlocation ruleの参照

---

## 📁 新しいファイル構成とモジュール

### サブディレクトリ対応
```
modules_complete/
├── firstview/
│   └── firstview_01_complete.php  # NEW!
├── hero_complete.php
├── problem_complete.php
├── benefit_complete.php
├── pricing_complete.php
├── contact_complete.php
└── module_loader.php              # 動的ACF制御対応
```

#### モジュールローダーの改善点
- **RecursiveDirectoryIterator**: サブディレクトリ内のモジュール自動検出
- **動的ACF制御**: 手動選択システムの実装
- **エラーハンドリング**: より堅牢なモジュール読み込み

---

## 🔧 開発者向け重要情報

### get_smart_location() 関数（簡単記述）

#### 新方式（推奨）
```php
acf_add_local_field_group(array(
    'key' => 'group_your_module',
    'title' => 'Your Module',
    'fields' => array(/* フィールド定義 */),
    'location' => get_smart_location(), // この1行のみ！
));
```

#### AIエージェントの説明方法
**ユーザーが新しいモジュールを作成したい場合**:
1. 「ACFのlocation設定は `'location' => get_smart_location(),` の1行のみ記述」
2. 「複雑な条件設定は不要」
3. 「システムが自動的に手動選択制御に対応」

### 従来の複雑な記述は不要
```php
// ❌ 使用禁止: 複雑な従来記述
'location' => array(
    array(
        array('param' => 'post_type', 'operator' => '==', 'value' => 'page'),
        array('param' => 'page_template', 'operator' => '==', 'value' => 'template.php'),
        // 複雑な条件...
    ),
),

// ✅ 推奨: シンプル記述
'location' => get_smart_location(),
```

---

## 🆕 Firstview Module（新モジュール）

### 基本情報
- **ショートコード**: `[firstview_01_module]`
- **ファイル**: `modules_complete/firstview/firstview_01_complete.php`
- **機能**: メインビジュアル、キャッチコピー、CTA、実績数値、メディア掲載

### ACFフィールド構成
```php
- firstview_01_main_catch      (textarea) メインキャッチコピー
- firstview_01_sub_catch       (textarea) サブキャッチコピー  
- firstview_01_cta_main        (text)     CTAメインテキスト
- firstview_01_cta_sub         (text)     CTAサブテキスト
- firstview_01_cta_link        (text)     CTAリンク先
- firstview_01_achievements    (repeater) 実績データ
- firstview_01_media_title     (text)     メディア掲載タイトル
- firstview_01_media_logos     (repeater) メディアロゴ
- firstview_01_bg_color        (select)   背景色
```

### 使用例
```php
[firstview_01_module main_catch="毎日の業務を<br>もっとスマートに"]
```

---

## 🚨 トラブルシューティングガイド

### 頻出問題と解決策

#### 問題1: ACFフィールドが表示されない
**症状**: ページ編集画面でACFフィールドが見えない

**AIの回答手順**:
1. 「右側サイドバーの🔧使用するモジュールを選択を確認」
2. 「必要なモジュールにチェックを入れる」
3. 「チェック後、下部にACFフィールドが表示される」
4. 「ブラウザの再読み込みを試す」

#### 問題2: チェックボックスが表示されない
**症状**: 右側メタボックスが見えない

**AIの回答手順**:
1. 「ページ編集画面か確認（投稿ではなくページ）」
2. 「画面右上の表示オプションで隠れていないか確認」
3. 「module_loader.phpが正しく読み込まれているか確認」

#### 問題3: チェックしてもACFが表示されない
**症状**: チェックボックスは動作するがACFフィールドが表示されない

**AIの回答手順**:
1. 「ブラウザのコンソールエラーを確認（F12 → Console）」
2. 「JavaScript エラーがある場合は報告」
3. 「ACFプラグインが有効か確認」
4. 「他のプラグインとの競合を確認」

#### 問題4: ショートコードが動作しない
**症状**: ショートコードを追加してもモジュールが表示されない

**AIの回答手順**:
1. 「ショートコード名の確認（スペルミス等）」
2. 「対応するモジュールが読み込まれているか確認」
3. 「管理画面→外観→モジュール管理で状況確認」

---

## 🎯 AIエージェントの説明戦略

### 段階的説明アプローチ

#### レベル1: 基本的な使い方
1. **ページ作成**: 新規ページ作成
2. **モジュール選択**: 右側チェックボックスで選択  
3. **フィールド入力**: 表示されたACFフィールドに入力
4. **ショートコード配置**: コンテンツにショートコード追加
5. **保存・公開**: 完了

#### レベル2: カスタマイズ
1. **属性による制御**: ショートコード属性での上書き
2. **デザイン調整**: 背景色やスタイル変更
3. **レスポンシブ確認**: モバイル表示の確認

#### レベル3: 開発者向け
1. **新モジュール作成**: `get_smart_location()` 使用
2. **カスタムフィールド追加**: ACF構造の理解
3. **システム拡張**: 高度なカスタマイズ

### 説明時の注意点

#### ✅ 推奨表現
- 「シンプルな1行記述で対応」
- 「チェックボックスで直感的に選択」
- 「確実に動作する手動選択方式」
- 「必要なフィールドのみ表示」

#### ❌ 避ける表現
- 「自動検出システム」（現在は無効）
- 「複雑なlocation rule設定」（不要）
- 「高度な技術的設定が必要」（実際はシンプル）

---

## 📊 システムの状態確認方法

### 正常動作の確認項目

1. **モジュールローダー**: 管理画面→外観→モジュール管理で確認
2. **ACF制御**: ページ編集画面右側にメタボックス表示
3. **JavaScript動作**: チェックボックス操作でリアルタイム切替
4. **状態保存**: ページ保存後の選択状態維持

### AIエージェントが確認すべき情報

**ユーザーから問題報告があった場合**:
1. 「WordPressのバージョン」
2. 「ACFプラグインのバージョン」
3. 「使用中のテーマ」
4. 「他のプラグインとの競合状況」
5. 「ブラウザコンソールのエラーメッセージ」

---

## 🔄 システム更新時の注意点

### v1.0からv1.1への主な変更

1. **ACF表示制御の変更**: 全表示→手動選択方式
2. **新モジュール追加**: firstview_01_module
3. **サブディレクトリ対応**: RecursiveDirectoryIterator実装
4. **get_smart_location()**: 1行記述方式導入

### 既存ユーザーへの影響

- **互換性**: 既存のショートコードは問題なく動作
- **ACF表示**: 初回は全モジュールが選択された状態
- **新機能**: 段階的に新しい選択機能を案内

---

## 🎉 成功事例とベストプラクティス

### 推奨ワークフロー

1. **ページ構成計画**: 必要なモジュールを事前に決定
2. **モジュール選択**: 計画に基づいてチェックボックス選択
3. **コンテンツ入力**: 表示されたACFフィールドに集中して入力
4. **ショートコード配置**: 適切な順序でショートコード配置
5. **プレビュー確認**: 表示を確認してから公開

### よくある成功パターン

#### ランディングページ構成例
```
[firstview_01_module]  ← ファーストビュー
[problem_module]       ← 課題提起
[benefit_module]       ← 解決策・効果
[pricing_module]       ← 料金プラン  
[contact_module]       ← お問い合わせ
```

#### 効率的な編集方法
1. 右側で必要なモジュール全てを一度にチェック
2. 上から順番にACFフィールドを入力
3. 最後にコンテンツエリアにショートコード配置

---

## 📝 AIエージェント用クイックリファレンス

### 緊急時の対応手順

**「ACFが表示されない」**:
→ 右側メタボックスのチェック確認 → ブラウザ再読み込み

**「モジュールが動作しない」**:  
→ 管理画面→外観→モジュール管理で読み込み状況確認

**「新モジュール作成したい」**:
→ `get_smart_location()` の1行記述を案内

**「システム全体の状況確認」**:
→ WordPress管理画面→外観→モジュール管理

### 頻出キーワードと回答

| ユーザー質問 | AIの回答ポイント |
|------------|-----------------|
| "ACFが表示されない" | 右側メタボックスでモジュール選択 |
| "どのモジュールを選べばいい?" | 使用予定のショートコードに対応するもの |
| "設定が複雑" | `get_smart_location()` の1行のみで設定完了 |
| "従来との違い" | 手動選択で確実性と使いやすさを向上 |

---

**Complete Independent Modules System v1.1** - AIエージェント向け技術ガイド完了

このガイドを参考に、ユーザーに最適なサポートを提供してください。 